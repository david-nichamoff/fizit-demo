{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div id="content-start" class="content">
    {% if error %}
        <div class="errornote">
            <p>{{ error }}</p>
        </div>
    {% else %}
        <!-- Header Section with Add Contract Button -->
    <!-- Header Section with Multiple Add Contract Buttons -->
        <div class="breadcrumbs-module">
            <h1 class="title">Select Contract to View</h1>
            <ul class="object-tools">
                {% for contract_type in contract_types %}
                    <li>
                        <a href="{% url 'custom_admin:add_contract' %}?contract_type={{ contract_type }}" class="addlink">
                            Add {{ contract_type|capfirst }} Contract
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Contract Type Filter -->
        <div class="module">
            <label for="contractTypeFilter">Filter by Contract Type:</label>
            <select id="contractTypeFilter">
                {% for contract_type in contract_types %}
                    <option value="{{ contract_type }}" {% if contract_type == selected_contract_type %}selected{% endif %}>
                        {{ contract_type|capfirst }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Contracts Table -->
        <div class="module">
            <table class="table table-striped results">
                <thead>
                    <tr>
                        <th scope="col">
                            <a href="{{ sorting_links.contract_idx }}">
                                Contract Index
                                {% if ordering == 'contract_idx' %}
                                    <span class="sorting-indicator">&#x25B2;</span>
                                {% elif ordering == '-contract_idx' %}
                                    <span class="sorting-indicator">&#x25BC;</span>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="{{ sorting_links.contract_name }}">
                                Contract Name
                                {% if ordering == 'contract_name' %}
                                    <span class="sorting-indicator">&#x25B2;</span>
                                {% elif ordering == '-contract_name' %}
                                    <span class="sorting-indicator">&#x25BC;</span>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="{{ sorting_links.is_quote }}">
                                Is Quote?
                            </a>
                        </th>                        
                        <th scope="col">
                            <a href="{{ sorting_links.is_active }}">
                                Is Active?
                            </a>
                        </th>
                        <th scope="col">
                            <a href="{{ sorting_links.last_updated }}">
                                Last Updated
                                {% if ordering == 'last_updated' %}
                                    <span class="sorting-indicator">&#x25B2;</span>
                                {% elif ordering == '-last_updated' %}
                                    <span class="sorting-indicator">&#x25BC;</span>
                                {% endif %}
                            </a>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for contract in contracts %}
                    <tr>
                        <td>
                            <a href="{% url 'custom_admin:view_contract' %}?contract_idx={{ contract.contract_idx }}&contract_type={{ contract.contract_type }}">
                                {{ contract.contract_idx }}
                            </a>
                        </td>
                        <td>{{ contract.contract_name }}</td>
                        <td>
                            {% if contract.is_quote %}
                                <img src="{% static 'admin/img/icon-yes.svg' %}" alt="True" class="icon-yes">
                            {% else %}
                                <img src="{% static 'admin/img/icon-no.svg' %}" alt="False" class="icon-no">
                            {% endif %}
                        </td>
                        <td>
                            {% if contract.is_active %}
                                <img src="{% static 'admin/img/icon-yes.svg' %}" alt="True" class="icon-yes">
                            {% else %}
                                <img src="{% static 'admin/img/icon-no.svg' %}" alt="False" class="icon-no">
                            {% endif %}
                        </td>
                        <td>{{ contract.last_updated }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="empty-result">No contracts available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
</div>

<!-- JavaScript to reload the page when the contract type filter changes -->
<script>
    document.getElementById("contractTypeFilter").addEventListener("change", function() {
        const selectedType = this.value;
        window.location.href = "?contract_type=" + selectedType;
    });
</script>

{% endblock %}