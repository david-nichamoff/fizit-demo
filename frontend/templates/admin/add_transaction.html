{% extends "admin/base_site.html" %}
{% load static %}

{% block extrahead %}
<script>
    const contracts = {{ contracts|default:"[]"|safe }};
    const contractTypes = {{ contract_types|default:"[]"|safe }};
    let defaultContractType = "{{ default_contract_type|escapejs }}";
</script>
<script src="{% static 'admin/js/add_transaction.js' %}?v1.6"></script>
{% endblock %}

{% block content %}
<div id="content-main">
    {% if error %}
        <div class="errornote">
            <p>{{ error }}</p>
    {% else %}
        <h1 class="title">Add Transaction</h1>
        <form method="post" class="transaction-form">
            {% csrf_token %}

            <fieldset class="module aligned">
                <!-- Select Contract Type -->
                <div class="form-row">
                    <div class="flex-container">
                        <label class="required" for="id_contract_type">Contract Type:</label>
                        <select id="id_contract_type" name="contract_type">
                            {% for contract_type in contract_types %}
                                <option value="{{ contract_type }}" {% if contract_type == default_contract_type %}selected{% endif %}>
                                    {{ contract_type|title }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Select Contract -->
                <div class="form-row">
                    <div class="flex-container">
                        <label class="required" for="{{ transaction_form.contract_idx.id_for_label }}">{{ transaction_form.contract_idx.label }}</label>
                        {{ transaction_form.contract_idx }}
                    </div>
                    <div class="help">{{ transaction_form.contract_idx.help_text }}</div>
                </div>

                <!-- Transaction Date -->
                <div class="form-row">
                    <div class="flex-container">
                        <label class="required" for="{{ transaction_form.transact_dt.id_for_label }}">{{ transaction_form.transact_dt.label }}</label>
                        {{ transaction_form.transact_dt }}
                    </div>
                    <div class="help">{{ transaction_form.transact_dt.help_text }}</div>
                </div>

                <!-- Transaction Logic -->
                <div class="form-row">
                    <div class="flex-container">
                        <label for="{{ transaction_form.transact_logic.id_for_label }}">{{ transaction_form.transact_logic.label }}</label>
                        {{ transaction_form.transact_logic }}
                    </div>
                    <div class="help">{{ transaction_form.transact_logic.help_text }}</div>
                </div>

                <!-- Transaction Data -->
                <div class="form-row">
                    <div class="flex-container">
                        <label class="required" for="{{ transaction_form.transact_data.id_for_label }}">{{ transaction_form.transact_data.label }}</label>
                        {{ transaction_form.transact_data }}
                    </div>
                    <div class="help">{{ transaction_form.transact_data.help_text }}</div>
                </div>

            </fieldset>

            <div class="submit-row">
                <input type="submit" value="Add Transaction" class="default" />
            </div>
        </form>
    {% endif %}
</div>

<!-- Hidden contracts data -->
<script id="contracts-data" type="application/json">
    {{ contracts|safe }}
</script>
{% endblock %}