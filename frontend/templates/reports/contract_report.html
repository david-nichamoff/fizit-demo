{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Contract Report</title>
    <link rel="stylesheet" href="contract_report.css">
</head>
<body>
    <div class="report-header">
        <img src="{{ logo_url }}" alt="FIZIT Logo" class="fizit-logo">
        <div class="report-title">
            <h1>{{ contract.contract_name }}</h1>
            <p class="report-date"><strong>Date:</strong> {{ report_date|date:"Y-m-d H:i" }} UTC</p>
        </div>
    </div>
    <!-- Contract -->
    <div class="section">
        <h2>Contract Details</h2>
        <table>
            <tbody>
                <tr>
                    <th>Contract Name</th>
                    <td>{{ contract.contract_name }}</td>
                </tr>
                {% if contract.advance_pct %}
                <tr>
                    <th>Advance Percentage</th>
                    <td>{{ contract.advance_pct }}</td>
                </tr>
                {% endif %}
                {% if contract.service_fee_pct %}
                <tr>
                    <th>Service Fee Percentage</th>
                    <td>{{ contract.service_fee_pct }}</td>
                </tr>
                {% endif %}
                {% if contract.service_fee_amt %}
                <tr>
                    <th>Service Fee Amount</th>
                    <td>{{ contract.service_fee_amt }}</td>
                </tr>
                {% endif %}
                {% if contract.service_fee_max %}
                <tr>
                    <th>Service Fee Max</th>
                    <td>{{ contract.service_fee_max }}</td>
                </tr>
                {% endif %}
                {% if contract.late_fee_pct %}
                <tr>
                    <th>Late Fee Percentage</th>
                    <td>{{ contract.late_fee_pct }}</td>
                </tr>
                {% endif %}
                {% if contract.min_threshold_amt %}
                <tr>
                    <th>Minimum Threshold</th>
                    <td>{{ contract.min_threshold_amt }}</td>
                </tr>
                {% endif %}
                {% if contract.max_threshold_amt %}
                <tr>
                    <th>Maximum Threshold</th>
                    <td>{{ contract.max_threshold_amt }}</td>
                </tr>
                {% endif %}
                <tr>
                    <th>Transaction Logic</th>
                    <td>{{ contract.transact_logic }}</td>
                </tr>
                <tr>
                    <th>Extended Data</th>
                    <td>{{ contract.extended_data }}</td>
                </tr>
                <tr>
                    <th>Is Active</th>
                    <td>{{ contract.is_active }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Settlements -->
    {% if settlements %}
    <div class="section">
        <h2>Settlements</h2>
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Due Date</th>
                    <th>Expected</th>
                    <th>Paid</th>
                    <th>Residual Exp</th>
                    <th>Residual Paid</th>
                    <th>Dispute</th>
                </tr>
            </thead>
            <tbody>
                {% for s in settlements %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ s.settle_due_dt|date:"Y-m-d" }}</td>
                    <td>${{ s.settle_exp_amt }}</td>
                    <td>${{ s.settle_pay_amt }}</td>
                    <td>${{ s.residual_exp_amt }}</td>
                    <td>${{ s.residual_pay_amt }}</td>
                    <td>{{ s.dispute_reason|default:"None" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- Parties -->
    <div class="section">
        <h2>Parties</h2>
        {% if parties %}
        <table>
            <thead>
                <tr>
                    <th>Party</th>
                    <th>Type</th>
                </tr>
            </thead>
            <tbody>
                {% for p in parties %}
                <tr>
                    <td>{{ p.party_code }}</td>
                    <td>{{ p.party_type }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p class="empty">No parties available.</p>
        {% endif %}
    </div>

    <!-- Transactions -->
    <div class="section">
        <h2>Transactions</h2>
        {% if transactions %}
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Date</th>
                    <th>Amount</th>
                    <th>Advanced</th>
                    <th>Advance Date</th>
                </tr>
            </thead>
            <tbody>
                {% for t in transactions %}
                <tr>
                    <td>{{ t.transact_idx }}</td>
                    <td>{{ t.transact_dt|date:"Y-m-d H:i" }}</td>
                    <td>${{ t.transact_amt }}</td>
                    <td>${{ t.advance_pay_amt }}</td>
                    <td>
                        {% if t.advance_pay_dt %}
                            {{ t.advance_pay_dt|date:"Y-m-d H:i" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                <tr class="transaction-detail">
                    <td colspan="5">
                        {% if t.transact_data %}
                        <div><strong>Transaction Data:</strong> <pre>{{ t.transact_data }}</pre></div>
                        {% endif %}
                        {% if t.extended_data %}
                        <div><strong>Extended Data:</strong> <pre>{{ t.extended_data }}</pre></div>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p class="empty">No transactions available.</p>
        {% endif %}
    </div>

    <!-- Artifacts -->
    <div class="section">
        <h2>Artifacts</h2>
        {% if artifacts %}
        <table>
            <thead>
                <tr>
                    <th>Index</th>
                    <th>Title</th>
                    <th>Type</th>
                    <th>Date Added</th>
                </tr>
            </thead>
            <tbody>
                {% for a in artifacts %}
                <tr>
                    <td>{{ a.artifact_idx }}</td>
                    <td>{{ a.doc_title }}</td>
                    <td>{{ a.doc_type }}</td>
                    <td>{{ a.added_dt|date:"Y-m-d H:i" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p class="empty">No artifacts available.</p>
        {% endif %}
    </div>
</body>
</html>